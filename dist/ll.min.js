/*! PROJECT_NAME - v0.1.0 - 2015-10-24
* http://icymorn.github.io/lambda-lite-js/
* Copyright (c) 2015 ICYMORN; Licensed MIT */
var ll={exports:{},require:function(a){return ll.exports[a]}},define=function(){function a(b,e,f){if(void 0!==c[b]&&c[b].load===!0)return!0;for(var g=!0,h=0,i=e.length;i>h;h++)void 0===c[e[h]]?g=!1:c[e[h]].load===!1&&(a(e[h],c[e[h]].depends,c[e[h]].func)||(g=!1));if(g){var j;ll.exports[b]={},f(ll.exports[b]),c[b].load=!0,delete d[b];for(j in d)a(j,c[j].depends,c[j].func);return!0}return d[b]=!0,!1}function b(){return e++}var c={},d={},e=0;return function(){if(1===arguments.length)arguments[0](morn);else if(2===arguments.length){var d;"string"==typeof arguments[0]?(d=arguments[0],c[d]={load:!1,depends:[],func:arguments[1]},a(d,[],arguments[1])):(d=b(),c[d]={load:!1,depends:arguments[0],func:arguments[1]},a(d,arguments[0],arguments[1]))}else if(3===arguments.length){var d=arguments[0];c[d]={load:!1,depends:arguments[1],func:arguments[2]},a(d,arguments[1],arguments[2])}}}();if("undefined"==typeof define)var define=function(a,b,c){c(exports)};if("undefined"==typeof require)var require=ll.require;if(define("./lex",["./util","./token","./node"],function(a){function b(a){var b=J[a];return void 0===b?-1:b}function c(){for(var a=E++;D>E&&F.isWhite(C.charAt(E));)E++;return C.slice(a,E)}function d(){for(var a=E++;D>E;){if("\n"===C.charAt(E)){E++;break}E++}return C.slice(a,E)}function e(){for(var a=E++;D>E;){if("*"===C.charAt(E)&&(E++,D>E&&"/"===C.charAt(E))){E++;break}E++}return C.slice(a,E)}function f(){for(var a=E,b=C.charAt(E++),c=b;D>E&&(b=C.charAt(E++),b!==c););if(b!==c)throw"no matching for: "+c;return C.slice(a+1,E-1)}function g(){for(var a,b=E++;D>E&&(a=C.charAt(E),F.isIdentifierBody(a));)E++;return C.slice(b,E)}function h(){for(var a,b=E++,c=!1;D>E;)if(a=C.charAt(E),F.isDigit(a))E++;else{if(c!==!1||"."!==a)break;c=!0,E++}return C.slice(b,E)}function i(){var a,b=C.charAt(E),c=E++;return F.isSinglePunctuator(b)?b:("+"===b?D>E&&(a=C.charAt(E),("+"===a||"="===a)&&E++):"-"===b?D>E&&(a=C.charAt(E),("-"===a||">"===a||"="===a)&&E++):"*"===b?D>E&&(a=C.charAt(E),"="===a&&E++):"/"===b?D>E&&(a=C.charAt(E),("="===a||"*"===a||"/"===a)&&E++):"="===b?D>E&&(a=C.charAt(E),"="===a&&(E++,D>E&&(a=C.charAt(E),"="===a&&E++))):">"===b?D>E&&(a=C.charAt(E),"="===a?E++:">"===a&&(E++,D>E&&(a=C.charAt(E),"="===a&&E++))):"<"===b?D>E&&(a=C.charAt(E),"="===a?E++:"<"===a&&(E++,D>E&&(a=C.charAt(E),"="===a&&E++))):"!"===b?D>E&&(a=C.charAt(E),"="===a&&(E++,D>E&&(a=C.charAt(E),"="===a&&E++))):"&"===b?D>E&&(a=C.charAt(E),"&"===a&&E++):"|"===b&&D>E&&(a=C.charAt(E),"|"===a&&E++),C.slice(c,E))}function j(){var a;for(K=L;D>E;){var b=C.charAt(E);if(F.isWhite(b))a=new G(I.White,c());else if(F.isDigit(b))a=new G(I.Numberic,h());else if(F.isIdentifierStart(b)){var j=g();a=F.isKeyword(j)?new G(I.Keyword,j):F.isBooleanLiteral(j)?new G(I.BooleanLiteral,j):F.isNullLiteral(j)?new G(I.NullLiteral,j):new G(I.Identifier,j)}else if(F.isPunctuator(b)){var j=i();a="//"===j?new G(I.CommentLiteral,j+d()):"/*"===j?new G(I.CommentLiteral,j+e()):new G(I.Punctuator,j)}else F.isLiteralStart(b)&&(a=new G(I.Literal,f()));if(a.type!==I.EOF&&a.type!==I.White)return L=a,a}return null!==K&&K.type!==I.EOF&&(K=L),L=new G(I.EOF,null)}function k(a){return L.value===a}function l(a){if(K.value!==a||K.type!==I.Punctuator)throw"expect for: "+a;j()}function m(a){if(K.value!==a||K.type!==I.Keyword)throw"expect for: "+a;j()}function n(a){if(L.value!==a||L.type!==I.Punctuator)throw"expect for:"+a;j(),j()}function o(){j();var a=A();if(null===a)return null;if(")"!==K.value)throw"expect for : )";return j(),a}function p(){var a=B();return null===a?null:s(0,a)}function q(){for(var a=[];K.type!==I.EOF;){if((K.type===I.Numberic||K.type===I.Literal||K.type===I.BooleanLiteral)&&a.push(K.value),k("]")){n("]");break}n(",")}return new H.listNode(a)}function r(){for(var a=p();;)if(K.type===I.Numberic||K.type===I.Identifier||K.type===I.Literal||K.type===I.BooleanLiteral)a=new H.callNode(a,p());else{if(K.type!==I.Punctuator)return a;if("("===K.value)a=new H.callNode(a,o());else if("$"===K.value)j(),a=new H.callNode(a,r());else if("."===K.value){j();var b=a,c=r();a=new H.lambdaNode("$1",new H.callNode(b,new H.callNode(c,new H.objectNode("$1"))))}else if(","===K.value)j(),a=new H.consNode(a,p());else{if("["!==K.value)return a;j(),a=q()}}}function s(a,c){if(K.type===I.Punctuator&";"===K.value)return c;for(;;){var d=b(K.value);if(a>d)return c;var e=K.value;j();var f=B();if(null===f)return null;var g=b(K.value);if(g>d&&(f=s(d+1,f),null===f))return null;var h=new H.expressionNode(e);h.left=c,h.right=f,c=h}}function t(){var a=new H.numberNode(Number(K.value));return j(),a}function u(){var a=new H.booleanNode("true"===K.value);return j(),a}function v(){var a=new H.literalNode(K.value);return j(),a}function w(){j();var a=K.value;n("->");var b=A();return new H.lambdaNode(a,b)}function x(){var a=new H.objectNode(K.value);return j(),a}function y(){j();var a=A();m("then");var b=A();m("else");var c=A(),d=new H.ifConditionNode(a,b,c);return d}function z(){j();var a,b,c=K.value;if(k("="))n("="),b=A();else{j();for(var d=[];!k("=");)b=x(),d.push(b);for(b=x(),d.push(b),l("="),b=A();d.length>0;)b=new H.lambdaNode(d.pop().id,b)}var e=b;if(k("->")){j();var f=A();a=new H.defineNode(c,e,f)}else j(),a=new H.defineNode(c,e,null);return a}function A(){return K.type===I.Punctuator&&"\\"===K.value?w():K.type===I.Keyword&&"let"===K.value?z():K.type===I.Punctuator&&";"===K.value?null:K.type===I.EOF?null:r()}function B(){return null===K?null:K.type===I.Identifier?x():K.type===I.Numberic?t():K.type===I.Literal?v():K.type===I.BooleanLiteral?u():K.type!==I.Punctuator?K.type===I.Keyword&&"if"===K.value?y():null:"("===K.value?o():'"'===K.value||"'"===K.value?v():void 0}var C,D,E,F=require("./util").Util,G=require("./token").Token,H=require("./node").Node,I={EOF:1,Identifier:2,Keyword:3,Numberic:4,Punctuator:5,Literal:6,NullLiteral:7,BooleanLiteral:8,CommentLiteral:9,List:10,White:11,Unknown:12},J={"||":10,"&&":20,"|":30,"^":40,"&":50,"==":60,"!=":60,"===":60,"!==":60,"<":70,">":70,"<=":70,">=":70,"<<":80,">>":80,"+":90,"-":90,"*":110,"/":110,"%":110,"++":110},K=null,L=null;a.parse=function(a){C=a,D=C.length,E=0,L=null},a.genTree=function(){var a=[];if(j(),j(),!K)return a;for(var b=0,c=1e3;K.type!==I.EOF&&b++<c;){for(var d=A();K.type===I.Punctuator&&";"===K.value;)j();if(!d)break;a.push(d)}return a}}),"undefined"==typeof define)var define=function(a,b,c){c(exports)};if("undefined"==typeof require)var require=ll.require;if(define("./node",[],function(a){function b(a){this.func=a}function c(a,b){this.callee=a,this.arg=b}function d(a){this.id=a}function e(a){this.value=a}function f(a){this.operator=a,this.left=null,this.right=null}function g(a,b){this.id=a,this.expre=b}function h(a){this.bool=a}function i(a){this.literal=a}function j(a,b,c){this.id=a,this.expre=b,this.body=c}function k(a,b,c){this.cond=a,this.expre1=b,this.expre2=c}function l(a){return a.constructor===Number?new e(a):a.constructor===String?new i(a):a.constructor===Boolean?new h(a):new e(a)}function m(a,b){this.expre1=a,this.expre2=b}function n(a){this.ele=a}var o={Function:1,Object:2,Expression:3};b.prototype.getValue=function(a){return this.func(a)},c.prototype.getValue=function(a){var b=this.arg.getValue(a),c=this.callee.getValue(a);return c(l(b))},d.prototype.getValue=function(a){var b=a.lookup(this.id);if(void 0===b)throw"Cannot to find: "+this.id;return b.getValue(a)},e.prototype.getValue=function(a){return this.value},f.prototype.getValue=function(a){var b=this.left.getValue(a),c=this.right.getValue(a);if("*"===this.operator)return b*c;if("/"===this.operator){if(0===c)throw"divided by zero";return b/c}if("+"===this.operator)return b+c;if("-"===this.operator)return b-c;if("=="===this.operator)return b===c;if("!="===this.operator)return b!==c;if(">"===this.operator)return b>c;if("<"===this.operator)return c>b;if(">="===this.operator)return b>=c;if("<="===this.operator)return c>=b;if("||"===this.operator)return b||c;if("&&"===this.operator)return b&&c;if("++"===this.operator){var d=b.concat(c);return d}},g.prototype.getValue=function(a){var b=new a.constructor(a),c=this.id,d=this.expre;return function(a){return b.add(c,a),d.getValue(b)}},h.prototype.getValue=function(a){return this.bool},i.prototype.getValue=function(a){return this.literal},j.prototype.getValue=function(a){return a.add(this.id,this.expre),null!==this.body?this.body.getValue(a):null},k.prototype.getValue=function(a){return this.cond.getValue(a)===!1?this.expre2.getValue(a):this.expre1.getValue(a)},m.prototype.getValue=function(a){return null===this.expre2?this.expre1.getValue(a):(this.expre1.getValue(a),this.expre2.getValue(a))},n.prototype.getValue=function(a){return this.ele},a.NODE=o,a.Node={},a.Node.callNode=c,a.Node.objectNode=d,a.Node.numberNode=e,a.Node.booleanNode=h,a.Node.literalNode=i,a.Node.defineNode=j,a.Node.lambdaNode=g,a.Node.expressionNode=f,a.Node.nativeFunction=b,a.Node.ifConditionNode=k,a.Node.consNode=m,a.Node.listNode=n}),"undefined"==typeof define)var define=function(a,b,c){c(exports)};if("undefined"==typeof require)var require=ll.require;if(define("./scope",["./node"],function(a){var b=require("./node").Node,c=function(a){this.root=void 0===a?null:a,this.table={}};c.prototype.add=function(a,b){this.table[a]=b},c.prototype.exist=function(a){return void 0!==this.lookup(a)},c.prototype.lookup=function(a){var b=this.table[a];return void 0===b?null===this.root?b:this.root.lookup(a):b};var d=new c;d.add("print",new b.lambdaNode("$1",new b.nativeFunction(function(a){console.log(a.lookup("$1").getValue(a))}))),d.add("length",new b.lambdaNode("$1",new b.nativeFunction(function(a){return a.lookup("$1").getValue(a).length}))),d.add("reverse",new b.lambdaNode("$1",new b.nativeFunction(function(a){return a.lookup("$1").getValue(a).concat().reverse()}))),d.add("not",new b.lambdaNode("$1",new b.nativeFunction(function(a){return!a.lookup("$1").getValue(a)}))),a.Scope=c,a.Root=d}),"undefined"==typeof define)var define=function(a,b,c){c(exports)};if("undefined"==typeof require)var require=ll.require;define("./token",[],function(a){function b(a,b){this.type=a,this.value=b}a.Token=b}),"undefined"==typeof define&&(define=function(a,b,c){c(exports)}),"undefined"==typeof require&&(require=ll.require),define("./util",[],function(a){var b={},c="0123456789abcdefABCDEF",d=["if","then","else","let"],e="+-*/!=|&^~%<>",f="[]{}(),:\\;$.";b.isDigit=function(a){return a>="0"&&"9">=a},b.isHexDigit=function(a){return c.indexOf(a)>-1},b.isOctalDigit=function(a){return a>="0"&&!1},b.isWhite=function(a){return" "===a||"	"===a||"\n"===a},b.isAlpha=function(a){return a>="a"&&"z">=a||a>="A"&&"Z">=a},b.isPunctuator=function(a){return e.indexOf(a)>-1||f.indexOf(a)>-1},b.isSinglePunctuator=function(a){return f.indexOf(a)>-1},b.isLiteralStart=function(a){return"'"===a||'"'===a},b.isBooleanLiteral=function(a){return"true"===a||"false"===a},b.isNullLiteral=function(a){return"null"===a},b.isPunctuatorStart=function(a){return e.index(a)>-1},b.isIdentifierStart=function(a){return this.isAlpha(a)||"_"===a},b.isIdentifierBody=function(a){return this.isIdentifierStart(a)||this.isDigit(a)},b.isKeyword=function(a){return d.indexOf(a)>-1},a.Util=b});