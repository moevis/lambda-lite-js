/*! PROJECT_NAME - v0.1.0 - 2016-05-09
* http://icymorn.github.io/lambda-lite-js/
* Copyright (c) 2016 ICYMORN; Licensed MIT */
var ll={exports:{},require:function(a){return ll.exports[a]}},define=function(){function a(b,e,f){if(void 0!==c[b]&&c[b].load===!0)return!0;for(var g=!0,h=0,i=e.length;i>h;h++)void 0===c[e[h]]?g=!1:c[e[h]].load===!1&&(a(e[h],c[e[h]].depends,c[e[h]].func)||(g=!1));if(g){var j;ll.exports[b]={},f(ll.exports[b]),c[b].load=!0,delete d[b];for(j in d)a(j,c[j].depends,c[j].func);return!0}return d[b]=!0,!1}function b(){return e++}var c={},d={},e=0;return function(){if(1===arguments.length)arguments[0](morn);else if(2===arguments.length){var d;"string"==typeof arguments[0]?(d=arguments[0],c[d]={load:!1,depends:[],func:arguments[1]},a(d,[],arguments[1])):(d=b(),c[d]={load:!1,depends:arguments[0],func:arguments[1]},a(d,arguments[0],arguments[1]))}else if(3===arguments.length){var d=arguments[0];c[d]={load:!1,depends:arguments[1],func:arguments[2]},a(d,arguments[1],arguments[2])}}}();if("undefined"==typeof define)var define=function(a,b,c){c(exports)};if("undefined"==typeof require)var require=ll.require;if(define("./lex",["./util","./token","./node","./pattern"],function(a){function b(a){var b=M[a];return void 0===b?-1:b}function c(){for(var a=G++;F>G&&H.isWhite(D.charAt(G));)G++;return D.slice(a,G)}function d(){for(var a=G++;F>G;){if("\n"===D.charAt(G)){G++;break}G++}return D.slice(a,G)}function e(){for(var a=G++;F>G;){if("*"===D.charAt(G)&&(G++,F>G&&"/"===D.charAt(G))){G++;break}G++}return D.slice(a,G)}function f(){for(var a=G,b=D.charAt(G++),c=b;F>G&&(b=D.charAt(G++),b!==c););if(b!==c)throw"no matching for: "+c;return D.slice(a+1,G-1)}function g(){for(var a,b=G++;F>G&&(a=D.charAt(G),H.isIdentifierBody(a));)G++;return D.slice(b,G)}function h(){for(var a,b=G++,c=!1;F>G;)if(a=D.charAt(G),H.isDigit(a))G++;else{if(c!==!1||"."!==a)break;c=!0,G++}return D.slice(b,G)}function i(){var a,b=D.charAt(G),c=G++;return H.isSinglePunctuator(b)?b:("+"===b?F>G&&(a=D.charAt(G),"+"!==a&&"="!==a||G++):"-"===b?F>G&&(a=D.charAt(G),"-"!==a&&">"!==a&&"="!==a||G++):"*"===b?F>G&&(a=D.charAt(G),"="===a&&G++):"/"===b?F>G&&(a=D.charAt(G),"="!==a&&"*"!==a&&"/"!==a||G++):"="===b?F>G&&(a=D.charAt(G),"="===a&&(G++,F>G&&(a=D.charAt(G),"="===a&&G++))):">"===b?F>G&&(a=D.charAt(G),"="===a?G++:">"===a&&(G++,F>G&&(a=D.charAt(G),"="===a&&G++))):"<"===b?F>G&&(a=D.charAt(G),"="===a?G++:"<"===a&&(G++,F>G&&(a=D.charAt(G),"="===a&&G++))):"!"===b?F>G&&(a=D.charAt(G),"="===a?(G++,F>G&&(a=D.charAt(G),"="===a&&G++)):"!"===a&&G++):"&"===b?F>G&&(a=D.charAt(G),"&"===a&&G++):"|"===b&&F>G&&(a=D.charAt(G),"|"===a&&G++),D.slice(c,G))}function j(){var a;for(P=G,N=O;F>G;){var b=D.charAt(G);if(H.isWhite(b))a=new I(L.White,c());else if(H.isDigit(b))a=new I(L.Numberic,h());else if(H.isIdentifierStart(b)){var j=g();a=H.isKeyword(j)?new I(L.Keyword,j):H.isBooleanLiteral(j)?new I(L.BooleanLiteral,j):H.isNullLiteral(j)?new I(L.NullLiteral,j):new I(L.Identifier,j)}else if(H.isPunctuator(b)){var j=i();a="//"===j?new I(L.CommentLiteral,j+d()):"/*"===j?new I(L.CommentLiteral,j+e()):new I(L.Punctuator,j)}else H.isLiteralStart(b)&&(a=new I(L.Literal,f()));if(a.type!==L.EOF&&a.type!==L.White)return O=a,a}return null!==N&&N.type!==L.EOF&&(N=O),O=new I(L.EOF,null)}function k(a){return O.value===a}function l(a){if(N.value!==a||N.type!==L.Punctuator)throw"expect for: "+a;j()}function m(a){if(N.value!==a||N.type!==L.Keyword)throw"expect for: "+a;j()}function n(a){if(O.value!==a||O.type!==L.Punctuator)throw"expect for:"+a;j(),j()}function o(){j();var a=B();if(null===a)return null;if(")"!==N.value)throw"expect for : )";return j(),a}function p(){var a=C();return null===a?null:s(0,a)}function q(){j();for(var a=[];N.type!==L.EOF;){if(N.type===L.Numberic?a.push(Number(N.value)):N.type!==L.Literal&&N.type!==L.BooleanLiteral||a.push(N.value),k("]")){n("]");break}n(",")}return new J.listNode(a,new J.SourceCode(D,E,P))}function r(){for(var a=p();;)if(N.type===L.Numberic||N.type===L.Identifier||N.type===L.Literal||N.type===L.BooleanLiteral)a=new J.callNode(a,p(),new J.SourceCode(D,E,P));else{if(N.type!==L.Punctuator)return a;if("("===N.value)a=new J.callNode(a,o(),new J.SourceCode(D,E,P));else if("$"===N.value)j(),a=new J.callNode(a,r(),new J.SourceCode(D,E,P));else if("."===N.value){j();var b=a,c=r();a=new J.lambdaNode("$1",new J.callNode(b,new J.callNode(c,new J.objectNode("$1",new J.SourceCode(D,E,P)),new J.SourceCode(D,E,P))),new J.SourceCode(D,E,P))}else{if(","!==N.value)return a;j(),a=new J.consNode(a,p(),new J.SourceCode(D,E,P))}}}function s(a,c){if(N.type===L.Punctuator&";"===N.value)return c;for(;;){var d=b(N.value);if(a>d)return c;var e=N.value;j();var f=C();if(null===f)return null;var g=b(N.value);if(g>d&&(f=s(d+1,f),null===f))return null;var h=new J.expressionNode(e,new J.SourceCode(D,E,P));h.left=c,h.right=f,c=h}}function t(){var a=new J.numberNode(Number(N.value),new J.SourceCode(D,E,P));return j(),a}function u(){var a=new J.booleanNode("true"===N.value,new J.SourceCode(D,E,P));return j(),a}function v(){var a=new J.literalNode(N.value,new J.SourceCode(D,E,P));return j(),a}function w(){j();var a=N.value;n("->");var b=B();return new J.lambdaNode(a,b,new J.SourceCode(D,E,P))}function x(){var a=new J.objectNode(N.value,new J.SourceCode(D,E,P));return j(),a}function y(){j();var a=B();m("then");var b=B();m("else");var c=B();return new J.ifConditionNode(a,b,c,new J.SourceCode(D,E,P))}function z(){j();var a,b,c=N.value;if(k("="))n("="),b=B();else if(j(),k("@"))b=A();else{for(var d=[];!k("=");)b=x(),d.push(b);for(b=x(),d.push(b),l("="),b=B();d.length>0;)b=new J.lambdaNode(d.pop().id,b,new J.SourceCode(D,E,P))}var e=b;if(N.type==L.Punctuator&&"->"==N.value){j();var f=B();a=new J.defineNode(c,e,f,new J.SourceCode(D,E,P))}else a=new J.defineNode(c,e,null,new J.SourceCode(D,E,P));return a}function A(){for(var a=[],b=[];N.type!==L.Punctuator&&"="!==N.value;){var c,d=x().id;l("@"),N.type===L.Keyword?"Boolean"===N.value?c=new K.unit(Boolean):"Number"===N.value?c=new K.unit(Number):"String"===N.value&&(c=new K.unit(String)):N.type===L.Numberic?c=new K.unit(Number(N.value)):N.type===L.BooleanLiteral?c=new K.unit("true"===N.value):N.type===L.Literal?c=new K.unit(N.value):N.type===L.Punctuator&&"*"===N.value&&(c=new K.any),a.push(d),b.push(c),j()}l("=");var e=B();for(e=new J.patternNode(a.concat(),b,e,new J.SourceCode(D,E,P));a.length>0;)e=new J.lambdaNode(a.pop(),e,new J.SourceCode(D,E,P));return e}function B(){return N.type===L.Punctuator&&"\\"===N.value?w():N.type===L.Keyword&&"let"===N.value?z():N.type===L.Punctuator&&";"===N.value?null:N.type===L.EOF?null:r()}function C(){return null===N?null:N.type===L.Identifier?x():N.type===L.Numberic?t():N.type===L.Literal?v():N.type===L.BooleanLiteral?u():N.type!==L.Punctuator?N.type===L.Keyword&&"if"===N.value?y():null:"("===N.value?o():'"'===N.value||"'"===N.value?v():"["===N.value?q():void 0}var D,E,F,G,H=require("./util").Util,I=require("./token").Token,J=require("./node").Node,K=require("./pattern").Pattern,L={EOF:1,Identifier:2,Keyword:3,Numberic:4,Punctuator:5,Literal:6,NullLiteral:7,BooleanLiteral:8,CommentLiteral:9,List:10,White:11,Unknown:12},M={"||":10,"&&":20,"|":30,"^":40,"&":50,"==":60,"!=":60,"===":60,"!==":60,"<":70,">":70,"<=":70,">=":70,"<<":80,">>":80,"+":90,"-":90,"*":110,"/":110,"%":110,"++":110,"!!":110,":":110},N=null,O=null,P=0;a.parse=function(a){D=a;var b=a.split("\n");E=[0];for(var c=0,d=0,e=b.length;e>d;++d)c+=b[d].length+1,E.push(c);F=D.length,P=0,G=0,O=null},a.genTree=function(){var a=[];if(j(),j(),!N)return a;for(var b=0,c=1e3;N.type!==L.EOF&&b++<c;){for(var d=B();N.type===L.Punctuator&&";"===N.value;)j();if(!d)break;a.push(d)}return a}}),"undefined"==typeof define)var define=function(a,b,c){c(exports)};if("undefined"==typeof require)var require=ll.require;if(define("./node",[],function(a){function b(a){this.func=a}function c(a,b,c){this.callee=a,this.arg=b,this.source=c}function d(a,b){this.id=a,this.source=b}function e(a){this.value=a}function f(a,b){this.operator=a,this.left=null,this.right=null,this.source=b}function g(a,b,c){this.id=a,this.expre=b,this.source=c}function h(a,b){this.bool=a,this.source=b}function i(a,b){this.literal=a}function j(a,b,c,d){this.id=a,this.expre=b,this.body=c,this.source=d}function k(a,b,c,d){this.cond=a,this.expre1=b,this.expre2=c,this.souce=d}function l(a){return a.constructor===Number?new e(a):a.constructor===String?new i(a):a.constructor===Boolean?new h(a):new e(a)}function m(a,b,c){this.expre1=a,this.expre2=b,this.source=c}function n(a,b){this.ele=a,this.source=b}function o(a,b,c,d){this.ids=a,this.patterns=b,this.next=null,this.expre=c,this.source=d}function p(a){this.message=a}function q(a,b,c){this.source=a,this.segment=b,this.index=c}var r={Function:1,Object:2,Expression:3};b.prototype.getValue=function(a){return this.func(a)},c.prototype.getValue=function(a){var b=this.arg.getValue(a),c=this.callee.getValue(a);return c(l(b))},d.prototype.getValue=function(a){var b=a.lookup(this.id);if(void 0===b)throw console.log(this.source.index),"Cannot to find: "+this.id+"\nat "+this.source.getCodeSegment();return b.getValue(a)},e.prototype.getValue=function(a){return this.value},f.prototype.getValue=function(a){var b,c=this.left.getValue(a);if("*"===this.operator)return b=this.right.getValue(a),c*b;if("/"===this.operator){if(b=this.right.getValue(a),0===b)throw"divided by zero";return c/b}if("+"===this.operator)return b=this.right.getValue(a),c+b;if("-"===this.operator)return b=this.right.getValue(a),c-b;if("=="===this.operator)return b=this.right.getValue(a),c===b;if("!="===this.operator)return b=this.right.getValue(a),c!==b;if(">"===this.operator)return b=this.right.getValue(a),c>b;if("<"===this.operator)return b=this.right.getValue(a),b>c;if(">="===this.operator)return b=this.right.getValue(a),c>=b;if("<="===this.operator)return b=this.right.getValue(a),b>=c;if("||"===this.operator)return c===!0?!0:this.right.getValue(a);if("&&"===this.operator)return c===!1?!1:this.right.getValue(a);if("++"===this.operator){b=this.right.getValue(a);var d=c.concat(b);return d}if(":"===this.operator)return b=this.right.getValue(a),c.constructor===Array?c.concat(b):[].concat(c,b);if("!!"===this.operator)return b=this.right.getValue(a),c[b];throw"cannot find a property."},g.prototype.getValue=function(a){var b=new a.constructor(a),c=this.id,d=this.expre;return function(a){return b.add(c,a),d.getValue(b)}},h.prototype.getValue=function(a){return this.bool},i.prototype.getValue=function(a){return this.literal},j.prototype.getValue=function(a){if(void 0===a.table[this.id])a.add(this.id,this.expre);else{for(var b=a.table[this.id];b.constructor===g;)b=b.expre;if(b.constructor===o)if(void 0===a.table[this.id])a.add(this.id,this.expre);else{for(;null!==b.next;)b=b.next;b.next=this.expre.expre}}return null!==this.body?this.body.getValue(a):null},k.prototype.getValue=function(a){return this.cond.getValue(a)===!1?this.expre2.getValue(a):this.expre1.getValue(a)},m.prototype.getValue=function(a){return null===this.expre2?this.expre1.getValue(a):(this.expre1.getValue(a),this.expre2.getValue(a))},n.prototype.getValue=function(a){return this.ele},o.prototype.getValue=function(a){var b=this.ids,c=this.patterns.every(function(c,d){return c.expect(a.lookup(b[d]).getValue(a))});return c?this.expre.getValue(a):null===this.next?null:this.next.getValue(a)},q.prototype.getCodeSegment=function(){for(var a=0,b=this.segment.length;b>a;++a)if(this.segment[a]>=this.index){for(var c=this.index-this.segment[a-1],d="^";d.length<c;d=" "+d);return"line "+a+"\n"+this.source.slice(this.segment[a-1],this.segment[a])+"\n"+d}},a.NODE=r,a.Node={},a.Node.callNode=c,a.Node.objectNode=d,a.Node.numberNode=e,a.Node.booleanNode=h,a.Node.literalNode=i,a.Node.defineNode=j,a.Node.lambdaNode=g,a.Node.expressionNode=f,a.Node.nativeFunction=b,a.Node.ifConditionNode=k,a.Node.consNode=m,a.Node.listNode=n,a.Node.patternNode=o,a.Node.Exception=p,a.Node.SourceCode=q}),"undefined"==typeof define)var define=function(a,b,c){c(exports)};if("undefined"==typeof require)var require=ll.require;if(define("./pattern",[],function(a){var b={};b.unit=function c(a){if(null===a)this.type=null,this.value=null;else if("function"==typeof a)this.type=a,this.value=null;else{if(void 0===a)return new b.any;this.type=a.constructor,this.value=a}if(a instanceof Array){var d=[];a.forEach(function(a){d.push(new c(a))}),this.array=d}},b.any=function(){},b.any.prototype.expect=function(a){return!0},b.unit.prototype.expect=function(a){if(null===a)return null===this.value;if(null===this.value)return a.constructor===this.type;if(void 0!==this.array){if(0===this.array.length&&0===a.length)return!0;if(this.array.length>a.length)return!1;for(var b=0,c=this.array.length;c>b;b++)if(this.array[b].expect(a[b])===!1)return!1;return!0}return this.value===a&&this.type===a.constructor},b.PatternMatching=function(a){var c=[];return a.forEach(function(a){for(var d=[],e=0,f=a.length-1;f>e;e++)d.push(new b.unit(a[e]));d.push(a[a.length-1]),c.push(d)}),function(){var a,b=arguments;return c.some(function(c){for(var d=!0,e=0,f=c.length-1;f>e;e++)c[e].expect(b[e])===!1&&(d=!1);if(d===!0){var g=c[f];a=g.apply(null,b)}return d}),a}},a.Pattern=b}),"undefined"==typeof define)var define=function(a,b,c){c(exports)};if("undefined"==typeof require)var require=ll.require;if(define("./scope",["./node"],function(a){var b=require("./node").Node,c=function(a){this.root=void 0===a?null:a,this.table={}};c.prototype.add=function(a,b){this.table[a]=b},c.prototype.exist=function(a){return void 0!==this.lookup(a)},c.prototype.lookup=function(a){var b=this.table[a];return void 0===b?null===this.root?b:this.root.lookup(a):b};var d=new c;d.add("print",new b.lambdaNode("$1",new b.nativeFunction(function(a){console.log(a.lookup("$1").getValue(a))}))),d.add("length",new b.lambdaNode("$1",new b.nativeFunction(function(a){return a.lookup("$1").getValue(a).length}))),d.add("reverse",new b.lambdaNode("$1",new b.nativeFunction(function(a){return a.lookup("$1").getValue(a).concat().reverse()}))),d.add("not",new b.lambdaNode("$1",new b.nativeFunction(function(a){return!a.lookup("$1").getValue(a)}))),d.add("map",new b.lambdaNode("$1",new b.lambdaNode("$2",new b.nativeFunction(function(a){var c=a.lookup("$1").getValue(a);return a.lookup("$2").getValue(a).map(function(a){return c(new b.numberNode(a))})})))),a.Scope=c,a.Root=d}),"undefined"==typeof define)var define=function(a,b,c){c(exports)};if("undefined"==typeof require)var require=ll.require;define("./token",[],function(a){function b(a,b){this.type=a,this.value=b}a.Token=b}),"undefined"==typeof define&&(define=function(a,b,c){c(exports)}),"undefined"==typeof require&&(require=ll.require),define("./util",[],function(a){var b={},c="0123456789abcdefABCDEF",d=["if","then","else","let","Number","String","List","Boolean"],e=["Number","String","List","Boolean"],f="+-*/!=|&^~%<>",g="[]{}(),@:\\;$.";b.isDigit=function(a){return a>="0"&&"9">=a},b.isHexDigit=function(a){return c.indexOf(a)>-1},b.isOctalDigit=function(a){return a>="0"&&!1},b.isWhite=function(a){return" "===a||"	"===a||"\n"===a},b.isAlpha=function(a){return a>="a"&&"z">=a||a>="A"&&"Z">=a},b.isPunctuator=function(a){return f.indexOf(a)>-1||g.indexOf(a)>-1},b.isSinglePunctuator=function(a){return g.indexOf(a)>-1},b.isLiteralStart=function(a){return"'"===a||'"'===a},b.isBooleanLiteral=function(a){return"true"===a||"false"===a},b.isNullLiteral=function(a){return"null"===a},b.isPunctuatorStart=function(a){return f.index(a)>-1},b.isIdentifierStart=function(a){return this.isAlpha(a)||"_"===a},b.isIdentifierBody=function(a){return this.isIdentifierStart(a)||this.isDigit(a)},b.isKeyword=function(a){return d.indexOf(a)>-1},b.isTypewords=function(a){return e.indexOf(a)>-1},a.Util=b});