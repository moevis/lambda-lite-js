/*! PROJECT_NAME - v0.1.0 - 2015-10-21
* http://icymorn.github.io/lambda-lite-js/
* Copyright (c) 2015 ICYMORN; Licensed MIT */
var ll={exports:{},require:function(a){return ll.exports[a]}},define=function(){function a(b,e,f){if(void 0!==c[b]&&c[b].load===!0)return!0;for(var g=!0,h=0,i=e.length;i>h;h++)void 0===c[e[h]]?g=!1:c[e[h]].load===!1&&(a(e[h],c[e[h]].depends,c[e[h]].func)||(g=!1));if(g){var j;ll.exports[b]={},f(ll.exports[b]),c[b].load=!0,delete d[b];for(j in d)a(j,c[j].depends,c[j].func);return!0}return d[b]=!0,!1}function b(){return e++}var c={},d={},e=0;return function(){if(1===arguments.length)arguments[0](morn);else if(2===arguments.length){var d;"string"==typeof arguments[0]?(d=arguments[0],c[d]={load:!1,depends:[],func:arguments[1]},a(d,[],arguments[1])):(d=b(),c[d]={load:!1,depends:arguments[0],func:arguments[1]},a(d,arguments[0],arguments[1]))}else if(3===arguments.length){var d=arguments[0];c[d]={load:!1,depends:arguments[1],func:arguments[2]},a(d,arguments[1],arguments[2])}}}();if("undefined"==typeof define)var define=function(a,b,c){c(exports)};if("undefined"==typeof require)var require=ll.require;if(define("./lex",["./util","./token","./node"],function(a){function b(a){var b=I[a];return void 0===b?-1:b}function c(){for(var a=D++;C>D&&E.isWhite(B.charAt(D));)D++;return B.slice(a,D)}function d(){for(var a=D++;C>D;){if("\n"===B.charAt(D)){D++;break}D++}return B.slice(a,D)}function e(){for(var a=D++;C>D;){if("*"===B.charAt(D)&&(D++,C>D&&"/"===B.charAt(D))){D++;break}D++}return B.slice(a,D)}function f(){for(var a=D,b=B.charAt(D++),c=b;C>D&&(b=B.charAt(D++),b!==c););if(b!==c)throw"no matching for: "+c;return B.slice(a+1,D-1)}function g(){for(var a,b=D++;C>D&&(a=B.charAt(D),E.isIdentifierBody(a));)D++;return B.slice(b,D)}function h(){for(var a,b=D++,c=!1;C>D;)if(a=B.charAt(D),E.isDigit(a))D++;else{if(c!==!1||"."!==a)break;c=!0,D++}return B.slice(b,D)}function i(){var a,b=B.charAt(D),c=D++;return E.isSinglePunctuator(b)?b:("+"===b?C>D&&(a=B.charAt(D),("+"===a||"="===a)&&D++):"-"===b?C>D&&(a=B.charAt(D),("-"===a||">"===a||"="===a)&&D++):"*"===b?C>D&&(a=B.charAt(D),"="===a&&D++):"/"===b?C>D&&(a=B.charAt(D),("="===a||"*"===a||"/"===a)&&D++):"="===b?C>D&&(a=B.charAt(D),"="===a&&(D++,C>D&&(a=B.charAt(D),"="===a&&D++))):">"===b?C>D&&(a=B.charAt(D),"="===a?D++:">"===a&&(D++,C>D&&(a=B.charAt(D),"="===a&&D++))):"<"===b?C>D&&(a=B.charAt(D),"="===a?D++:"<"===a&&(D++,C>D&&(a=B.charAt(D),"="===a&&D++))):"!"===b&&C>D&&(a=B.charAt(D),"="===a&&(D++,C>D&&(a=B.charAt(D),"="===a&&D++))),B.slice(c,D))}function j(){var a;for(J=K;C>D;){var b=B.charAt(D);if(E.isWhite(b))a=new F(H.White,c());else if(E.isDigit(b))a=new F(H.Numberic,h());else if(E.isIdentifierStart(b)){var j=g();a=E.isKeyword(j)?new F(H.Keyword,j):E.isBooleanLiteral(j)?new F(H.BooleanLiteral,j):E.isNullLiteral(j)?new F(H.NullLiteral,j):new F(H.Identifier,j)}else if(E.isPunctuator(b)){var j=i();a="//"===j?new F(H.CommentLiteral,j+d()):"/*"===j?new F(H.CommentLiteral,j+e()):new F(H.Punctuator,j)}else E.isLiteralStart(b)&&(a=new F(H.Literal,f()));if(a.type!==H.EOF&&a.type!==H.White)return K=a,a}return null!==J&&J.type!==H.EOF&&(J=K),K=new F(H.EOF,null)}function k(a){return K.value===a}function l(a){if(J.value!==a||J.type!==H.Punctuator)throw"expect for: "+a;j()}function m(a){if(J.value!==a||J.type!==H.Keyword)throw"expect for: "+a;j()}function n(a){if(K.value!==a||K.type!==H.Punctuator)throw"expect for:"+a;j(),j()}function o(){j();var a=q();if(null===a)return null;if(")"!==J.value)throw"expect for : )";return j(),a}function p(){var a=A();return null===a?null:r(0,a)}function q(){for(var a=p();;)if(J.type===H.Numberic||J.type===H.Identifier||J.type===H.Literal)a=new G.callNode(a,p());else{if(J.type!==H.Punctuator)return a;if("("===J.value)a=new G.callNode(a,o());else if("$"===J.value)j(),a=new G.callNode(a,q());else{if("."!==J.value)return a;j();var b=a,c=q();a=new G.lambdaNode("$1",new G.callNode(b,new G.callNode(c,new G.objectNode("$1"))))}}}function r(a,c){for(;;){var d=b(J.value);if(a>d)return c;var e=J.value;j();var f=A();if(null===f)return null;var g=b(J.value);if(g>d&&(f=r(d+1,f),null===f))return null;var h=new G.expressionNode(e);h.left=c,h.right=f,c=h}}function s(){var a=new G.numberNode(Number(J.value));return j(),a}function t(){var a=new G.booleanNode("true"===J.value);return j(),a}function u(){var a=new G.literalNode(J.value);return j(),a}function v(){j();var a=J.value;n("->");var b=z();return new G.lambdaNode(a,b)}function w(){var a=new G.objectNode(J.value);return j(),a}function x(){j();var a=z();m("then");var b=z();m("else");var c=z(),d=new G.ifConditionNode(a,b,c);return d}function y(){j();var a,b,c=J.value;if(k("="))n("="),b=z();else{j();for(var d=[];;)if(b=w(),d.push(b),k("=")){b=w(),d.push(b);break}for(l("="),b=z();d.length>0;)b=new G.lambdaNode(d.pop().id,b)}var e=b;if(k("->")){j();var f=z();a=new G.defineNode(c,e,f)}else j(),a=new G.defineNode(c,e,null);return a}function z(){return J.type===H.Punctuator&&"\\"===J.value?v():J.type===H.Keyword&&"let"===J.value?y():J.type===H.Punctuator&&";"===J.value?null:J.type===H.EOF?null:q()}function A(){return null===J?null:J.type===H.Identifier?w():J.type===H.Numberic?s():J.type===H.Literal?u():J.type===H.BooleanLiteral?t():J.type!==H.Punctuator?J.type===H.Keyword&&"if"===J.value?x():null:"("===J.value?o():'"'===J.value||"'"===J.value?u():void 0}var B,C,D,E=require("./util").Util,F=require("./token").Token,G=require("./node").Node,H={EOF:1,Identifier:2,Keyword:3,Numberic:4,Punctuator:5,Literal:6,NullLiteral:7,BooleanLiteral:8,CommentLiteral:9,White:10,Unknown:11},I={"||":10,"&&":20,"|":30,"^":40,"&":50,"==":60,"!=":60,"===":60,"!==":60,"<":70,">":70,"<=":70,">=":70,"<<":80,">>":80,"+":90,"-":90,"*":110,"/":110,"%":110},J=null,K=null;a.parse=function(a){B=a,C=B.length,D=0,K=null},a.genTree=function(){var a=[];if(j(),j(),!J)return a;for(var b=0,c=1e3;J.type!==H.EOF&&b++<c;){var d=z();if(!d)break;a.push(d)}return a}}),"undefined"==typeof define)var define=function(a,b,c){c(exports)};if("undefined"==typeof require)var require=ll.require;if(define("./node",[],function(a){function b(a){this.func=a}function c(a,b){this.callee=a,this.arg=b}function d(a){this.id=a}function e(a){this.value=a}function f(a){this.operator=a,this.left=null,this.right=null}function g(a,b){this.id=a,this.expre=b}function h(a){this.bool=a}function i(a){this.literal=a}function j(a,b,c){this.id=a,this.expre=b,this.body=c}function k(a,b,c){this.cond=a,this.expre1=b,this.expre2=c}function l(a){return a.constructor===Number?new e(a):a.constructor===String?new i(a):a.constructor===Boolean?new h(a):new e(a)}var m={Function:1,Object:2,Expression:3};b.prototype.getValue=function(a){return this.func(a)},c.prototype.getValue=function(a){var b=this.callee.getValue(a),c=this.arg.getValue(a);return b(l(c))},d.prototype.getValue=function(a){var b=a.lookup(this.id);if(void 0===b)throw"Cannot to find: "+this.id;return b.getValue(a)},e.prototype.getValue=function(a){return this.value},f.prototype.getValue=function(a){var b=this.left.getValue(a),c=this.right.getValue(a);if("*"===this.operator)return b*c;if("/"===this.operator){if(0===c)throw"divided by zero";return b/c}return"+"===this.operator?b+c:"-"===this.operator?b-c:"=="===this.operator?b===c:"!="===this.operator?b!==c:">"===this.operator?b>c:"<"===this.operator?c>b:">="===this.operator?b>=c:"<="===this.operator?c>=b:void 0},g.prototype.getValue=function(a){var b=new a.constructor(a),c=this.id,d=this.expre;return function(a){return b.add(c,a),d.getValue(b)}},h.prototype.getValue=function(a){return this.bool},i.prototype.getValue=function(a){return this.literal},j.prototype.getValue=function(a){return a.add(this.id,this.expre),null!==this.body?this.body.getValue(a):null},k.prototype.getValue=function(a){return this.cond.getValue(a)===!1?this.expre2.getValue(a):this.expre1.getValue(a)},a.NODE=m,a.Node={},a.Node.callNode=c,a.Node.objectNode=d,a.Node.numberNode=e,a.Node.booleanNode=h,a.Node.literalNode=i,a.Node.defineNode=j,a.Node.lambdaNode=g,a.Node.expressionNode=f,a.Node.nativeFunction=b,a.Node.ifConditionNode=k}),"undefined"==typeof define)var define=function(a,b,c){c(exports)};if("undefined"==typeof require)var require=ll.require;if(define("./scope",["./node"],function(a){var b=require("./node").Node,c=function(a){this.root=void 0===a?null:a,this.table={}};c.prototype.add=function(a,b){this.table[a]=b},c.prototype.exist=function(a){return void 0!==this.lookup(a)},c.prototype.lookup=function(a){var b=this.table[a];return void 0===b?null===this.root?b:this.root.lookup(a):b};var d=new c;d.add("print",new b.lambdaNode("$1",new b.nativeFunction(function(a){console.log(a.lookup("$1").getValue(a))}))),a.Scope=c,a.Root=d}),"undefined"==typeof define)var define=function(a,b,c){c(exports)};if("undefined"==typeof require)var require=ll.require;define("./token",[],function(a){function b(a,b){this.type=a,this.value=b}a.Token=b}),"undefined"==typeof define&&(define=function(a,b,c){c(exports)}),"undefined"==typeof require&&(require=ll.require),define("./util",[],function(a){var b={},c="0123456789abcdefABCDEF",d=["if","then","else","let"],e="+-*/!=|&^~%",f="[]{}(),:\\;$.";b.isDigit=function(a){return a>="0"&&"9">=a},b.isHexDigit=function(a){return c.indexOf(a)>-1},b.isOctalDigit=function(a){return a>="0"&&!1},b.isWhite=function(a){return" "===a||"	"===a||"\n"===a},b.isAlpha=function(a){return a>="a"&&"z">=a||a>="A"&&"Z">=a},b.isPunctuator=function(a){return e.indexOf(a)>-1||f.indexOf(a)>-1},b.isSinglePunctuator=function(a){return f.indexOf(a)>-1},b.isLiteralStart=function(a){return"'"===a||'"'===a},b.isBooleanLiteral=function(a){return"true"===a||"false"===a},b.isNullLiteral=function(a){return"null"===a},b.isPunctuatorStart=function(a){return e.index(a)>-1},b.isIdentifierStart=function(a){return this.isAlpha(a)||"_"===a},b.isIdentifierBody=function(a){return this.isIdentifierStart(a)||this.isDigit(a)},b.isKeyword=function(a){return d.indexOf(a)>-1},a.Util=b});